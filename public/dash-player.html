<!DOCTYPE html>
<html>

<head>
    <title>DASH Player</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }
    </style>
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
</head>

<body>
    <video controls data-dashjs-player autoplay muted></video>
    <script>
        const video = document.querySelector('video');

        video.onloadedmetadata = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const camId = urlParams.get('cam');
            if (camId) {
                window.parent.postMessage({
                    type: 'resolution',
                    cameraId: camId,
                    width: video.videoWidth,
                    height: video.videoHeight
                }, "*");
            }
        };

        window.addEventListener('message', (event) => {
            if (event.origin !== window.location.origin) return;
            if (event.data.type === 'requestFullscreen' && video) {
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                } else if (video.webkitRequestFullscreen) { /* Safari */
                    video.webkitRequestFullscreen();
                } else if (video.msRequestFullscreen) { /* IE11 */
                    video.msRequestFullscreen();
                }
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const camId = urlParams.get('cam');
            if (camId) {
                const video = document.querySelector('video');
                const player = dashjs.MediaPlayer().create();
                const url = `/dash/cam_${camId}/index.mpd`;
                player.initialize(video, url, true);
            } else {
                document.body.innerHTML = '<h1>Error: Camera ID is missing. Please specify a camera with ?cam=ID</h1>';
            }
        });
    </script>
</body>

</html>